<% content_for :head do %>
    <link href="/css/BigSlide.css" type="text/css" rel="stylesheet">
    <script src="/js/BigSlide.js" type="text/javascript"></script>
    <link href="/css/modal.css" type="text/css" rel="stylesheet">
    <script src="/js/index.js" type="text/javascript"></script>
    <script src="js/jsrender.js" type="text/javascript"></script>
<% end %>

<body>
<%= render "shared/right_top_main" %>

<div id="Big_Slide_box">
  <div id="Big_Slide">
    <ul>
      <li style=" background:#E81216;" id="Big_Slide_0"><img src="images/1_.jpg"></li>
      <li style=" background:#000000;" id="Big_Slide_1"><img src="images/2_.jpg"></li>
      <li style=" background:#4144D7;" id="Big_Slide_2"><img src="images/3_.jpg"></li>
    </ul>
    <a id="Big_Slide_Last"></a>
    <a id="Big_Slide_Next"></a>
    <div id="Big_Slide_Tab"></div>
    <div id="prevL" class="prev" ></div>
    <div id="prevR" class="prev" ></div>
    <div id='subscribe' class='carousel-caption'>
      <div class='h1'>HUNT CODE</div>
      <div class='h5'>邮件订阅,发现好项目</div>
      <form class="form-inline">
        <div class="form-group">
          <label for="email" class="sr-only">email</label>
          <input type="email" class="form-control" id="email" placeholder="Email">
        </div>
        <button type="submit" class="btn btn-primary">订阅</button>
      </form>
    </div>
  </div>

</div>
<div class="container">
  <script id="projectListTmp" type="text/x-jsrender">
            <li>
                <div class="date-time">
                    <div class="square-content">
                        <span class="square"></span>
                        <span class="trigngle-icon"></span>
                    </div>
                    <div class="v-line"></div>
                    <div class=" square-content rotate45">
                        <span class="square"></span>
                        <span class="time rotate-45">{{:date}}</span>
                    </div>
                </div>
                <div class="projects-wapper">
                    <!--<h4 class="date">12月12日</h4>-->
                    <ul id="day-project-list" class="project-list list-unstyled">
                        {{for projects}}
                            <li class="data-li">
                                <button class="btn fl up_bt">
                                    <span class="up_icon glyphicon glyphicon-triangle-top block"></span>
                                    <span class="up_num ">{{:star_num}}</span>
                                </button>
                                <div class="project-des fl">

                          <h4><a href="/projects/{{:project.id}}">{{:project.title}}<span class="lang-label label label-info">{{:project.language}}</span></a></h4>
                                    <p>{{:project.intro_content}}</p>
                                </div>
                                <div class="up_user_list fr">
                                    <ul class="nav nav-pills">
                                        {{for #data.star_users ~starNum=#data.star_num}}
                                            {{if #index+1 === #parent.parent.data.star_users.length}}
                                                <li class="user_ava_li">
                                                    <img class="img-responsive user-avatar" src="{{:user_avatar}}"></img>
                                                    <div class="project-comment">
                                                        <a class="project-comments">{{:~starNum}}</a>
                                                    </div>
                                                </li>
                                            {{else}}
                                                <li class="user_ava_li">
                                                    <img class="img-responsive user-avatar" src="{{:user_avatar}}"></img>
                                                </li>
                                            {{/if}}
                                        {{/for}}
                                    </ul>
                                </div>
                            </li>
                        {{/for}}
                    </ul>
                </div>
            </li>
    </script>
    <script id="projectListTmp2" type="text/x-jsrender">
    <li>
        <div class="date-time">
            <div class="square-content">
                <span class="square"></span>
                <span class="trigngle-icon"></span>
            </div>
            <div class="v-line"></div>
            <div class=" square-content rotate45">
                <span class="square"></span>
                <span class="time rotate-45">{{:date}}</span>
            </div>
        </div>
        <div class="projects-wapper">
            <ul id="day-project-list" class="project-list list-unstyled">
                {{for data}}
                    <li class="data-li">
                        <button class="btn fl up_bt">
                            <span class="up_icon glyphicon glyphicon-triangle-top block"></span>
                            <span class="up_num ">{{:star_num}}</span>
                        </button>
                        <div class="project-des fl">
                          <h4><a href="/projects/{{:project.id}}">{{:project.title}}<span class="lang-label label label-info">{{:project.language}}</span></a></h4>
<p>{{:project.intro_content.substring(0, 65)}}</p>
                        </div>
                        <div class="up_user_list fr">
                            <ul class="nav nav-pills">
                                {{for #data.star_users ~starNum=#data.star_num}}
                                    {{if #index+1 === #parent.parent.data.star_users.length}}
                                        <li class="user_ava_li">
                                            <img class="img-responsive user-avatar" src="/images/logo.png"></img>
                                            <div class="project-comment">
                                                <a class="project-comments">{{:~starNum}}</a>
                                            </div>
                                        </li>
                                    {{else}}
                                        <li class="user_ava_li">
                                            <img class="img-responsive user-avatar" src="/images/logo.png"></img>
                                        </li>
                                    {{/if}}
                                {{/for}}
                            </ul>
                        </div>
                    </li>
                {{/for}}
            </ul>
        </div>
    </li>
    </script>
  <ul id="project-list">
  </ul>
  <!-- 展开剩余日期-->
  <div class="load_pre_date">
    <h3 class="main-color">展开剩余日期</h3>
    <a href="javascript:void(0);" data-date="2016-01-13" id="load-more-project"class="load_pre_date_icon"></a>
  </div>
</div>

<% content_for :tail do %>
<script type="text/javascript">
var project_dates = <%= raw @project_dates %>;
var current_date_index = 0;
function ajax_data (startdate){
  $.ajax({
    url: '/projects/date/'+ startdate,
    dataType: 'json',
    success: function (data) {
      var template = $.templates("#projectListTmp2");  
      var htmlOutput = template.render(data);  
      var orignal = $("#project-list")[0].innerHTML;
      $("#project-list").html(orignal + htmlOutput);
      current_date_index = current_date_index + 1;
      $("#load-more-project")[0].dataset.date = project_dates[current_date_index];
    }
  });
};
ajax_data(project_dates[0]);
ajax_data(project_dates[1]);
</script>
<% end %>



